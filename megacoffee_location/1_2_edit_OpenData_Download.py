# -*- coding: utf-8 -*-
"""
Created on Wed Feb 19 18:36:54 2025

@author: Roh Jun Seok

매장 수와 한국인 인구수 비교
매장 수와 외국인 인구수 비교
매장 수와 업종별 종사자 수 비교
업종별 => 상위 5개 업종
"""
import pandas as pd

# 1. 인구현황: report.txt 파일 읽기 및 컬럼명 재정의
pop_df = pd.read_csv('./files/report.txt', sep='\t', header=2)
pop_df.info()

columns = {
    '기간': '기간',
    '자치구': '시군구명',
    '세대': '세대',
    '계': '전체',
    '남자': '남자_전체',
    '여자': '여자_전체',
    '계.1': '한국인_전체',
    '남자.1': '남자_한국인',
    '여자.1': '여자_한국인',
    '계.2': '외국인_전체',
    '남자.2': '남자_외국인',
    '여자.2': '여자_외국인',
    '세대당인구': '세대당_인구',
    '65세이상고령자': '고령자'
}
pop_df.rename(columns=columns, inplace=True)

pop_df = pop_df[pop_df['시군구명'] != '합계']

# 필요한 컬럼만 선택: 시군구명, 한국인_전체, 외국인_전체
pop_extracted = pop_df[['시군구명', '한국인_전체', '외국인_전체']]

pop_extracted.to_excel('./files/sgg_pop.xlsx', index=False)

# 2. report2.txt
df = pd.read_csv('./files/report2.txt', sep='\t', header=[0,1,2])
df.columns = ['_'.join([str(item).strip() for item in col if str(item) != 'nan' and str(item) != '']) for col in df.columns]

print(df.columns.tolist())

rename_dict = {
    '기간_기간_기간': '기간',
    '자치구_자치구_자치구': '시군구명',
    '동_동_동': '동',
    '합계_사업체수_사업체수': '전체_사업체수',
    '합계_사업체수_여성대표자': '전체_여성대표자',
    '합계_종사자수_계': '전체_종사자수',
    '합계_종사자수_남': '전체_남자종사자수',
    '합계_종사자수_여': '전체_여자종사자수',
    '농업 임업 및 어업_사업체수_사업체수': '농업임업및어업_업체수',
    '농업 임업 및 어업_종사자수_종사자수': '농업임업및어업_종사자수',
    '광업_사업체수_사업체수': '광업업체수',
    '광업_종사자수_종사자수': '광업_종사자수',
    '제조업_사업체수_사업체수': '제조업업체수',
    '제조업_종사자수_종사자수': '제조업_종사자수',
    '전기 가스 증기 및 공기조절 공급업_사업체수_사업체수': '전기가스업체수',
    '전기 가스 증기 및 공기조절 공급업_종사자수_종사자수': '전기가스_종사자수',
    '수도 하수 및 폐기물 처리 원료 재생업_사업체수_사업체수': '수도하수업체수',
    '수도 하수 및 폐기물 처리 원료 재생업_종사자수_종사자수': '수도하수_종사자수',
    '건설업_사업체수_사업체수': '건설업체수',
    '건설업_종사자수_종사자수': '건설업_종사자수',
    '도매 및 소매업_사업체수_사업체수': '도매소매업체수',
    '도매 및 소매업_종사자수_종사자수': '도매소매업_종사자수',
    '운수 및 창고업_사업체수_사업체수': '운수창고업체수',
    '운수 및 창고업_종사자수_종사자수': '운수창고업_종사자수',
    '숙박 및 음식점업_사업체수_사업체수': '숙박음식점업체수',
    '숙박 및 음식점업_종사자수_종사자수': '숙박음식점업_종사자수',
    '정보통신업_사업체수_사업체수': '정보통신업체수',
    '정보통신업_종사자수_종사자수': '정보통신업_종사자수',
    '금융 및 보험업_사업체수_사업체수': '금융보험업체수',
    '금융 및 보험업_종사자수_종사자수': '금융보험업_종사자수',
    '부동산업_사업체수_사업체수': '부동산업체수',
    '부동산업_종사자수_종사자수': '부동산업_종사자수',
    '전문 과학 및 기술 서비스업_사업체수_사업체수': '전문서비스업체수',
    '전문 과학 및 기술 서비스업_종사자수_종사자수': '전문서비스업_종사자수',
    '사업시설 관리 사업 지원 및 임대 서비스업_사업체수_사업체수': '사업시설관리업체수',
    '사업시설 관리 사업 지원 및 임대 서비스업_종사자수_종사자수': '사업시설관리업_종사자수',
    '공공행정 국방 및 사회보장 행정_사업체수_사업체수': '공공행정업체수',
    '공공행정 국방 및 사회보장 행정_종사자수_종사자수': '공공행정업_종사자수',
    '교육 서비스업_사업체수_사업체수': '교육업체수',
    '교육 서비스업_종사자수_종사자수': '교육서비스업_종사자수',
    '보건업 및 사회복지 서비스업_사업체수_사업체수': '보건사회복지업체수',
    '보건업 및 사회복지 서비스업_종사자수_종사자수': '보건사회복지업_종사자수',
    '예술 스포츠 및 여가관련 서비스업_사업체수_사업체수': '예술스포츠업체수',
    '예술 스포츠 및 여가관련 서비스업_종사자수_종사자수': '예술스포츠업_종사자수',
    '협회 및 단체 수리 및 기타 개인 서비스업_사업체수_사업체수': '협회및개인서비스업체수',
    '협회 및 단체 수리 및 기타 개인 서비스업_종사자수_종사자수': '협회및개인서비스업_종사자수'
}

df.rename(columns=rename_dict, inplace=True)
print(df.columns.tolist())

# 3. '동'이 '소계'인 행만 필터링
df_filter = df[df['동'] == '소계'].copy()

# 4. 상위 5개 업종 (이미 계산 완료)
#    예) 도매소매업, 사업시설관리업, 숙박음식점업, 전문서비스업, 건설업
top5_cols = [
    '도매소매업_종사자수',
    '사업시설관리업_종사자수',
    '숙박음식점업_종사자수',
    '전문서비스업_종사자수',
    '건설업_종사자수'
]

# 5. 위 5개 업종 컬럼 + 시군구명만 추출
cols_to_save = ['시군구명'] + top5_cols
df_top5 = df_filter[cols_to_save].copy()

# (옵션) 만약 숫자열에 콤마가 포함되어 있다면 제거하고 변환
for col in top5_cols:
    df_top5[col] = pd.to_numeric(
        df_top5[col].astype(str).str.replace(',', ''),
        errors='coerce'
    )

df_top5.info()

columns = {
    '도매소매업_종사자수':'도매소매업',
    '사업시설관리업_종사자수':'사업시설관리업',
    '숙박음식점업_종사자수':'숙박음식점업',
    '전문서비스업_종사자수':'전문서비스업',
    '건설업_종사자수':'건설업'
}
df_top5.rename(columns=columns, inplace=True)

df_top5.to_excel('./files/top5.xlsx', index=False)
